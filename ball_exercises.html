<!DOCTYPE html>
<html>

<head>
  <!-- tells the browser to use the utf-8 character encoding -->
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="assets/css/style.css"/>

  <title> Ball Exercises </title>

</head>

<body>

  <div id="sidebar">
    <div id="listContainer">
      <div id="list-title"> Balls </div>
      <div id="ballList"></div>
    </div>
  </div>

<!-- setting up the canvas, describing its size -->
<canvas id="myCanvas" width="480" height="320"></canvas>

<!-- setting up buttons -->
<div class ="buttonContainer">
  <button id="addBallsButton" class="button">ü§πüèæ‚Äç</button>
  <button id="playPauseButton" class="button">‚è∏Ô∏è‚Äç</button>
</div>

<div class="slideContainer">
  <input type="range" min="0" max="10" value="5" class="slider" id="speedSlider">
  <p>Speed: <span id="speed"></span></p>
</div>

<!-- setting up buttons -->
<div class ="buttonContainer">
  <button id="addButton" class="button" onclick="addBall()">ü§πüèæ‚Äç</button>
  <button id="playPauseButton" class="button" onclick="ballPlayPause()">‚è∏Ô∏è‚Äç</button>
</div>

<div class="slideContainer">
  <input type="range" min="0" max="10" value="5" class="slider" id="speedSlider">
  <p>Speed: <span id="speed"></span></p>
</div>

<script>
    // storing a reference to the canvas element under the name "canvas"
    var canvas = document.getElementById("myCanvas");

    // creating the ctx variable to store the 2d rendering context.
    // this is what will actually "paint" on the "canvas"
    var ctx = canvas.getContext("2d");

    // array of balls + list of ball HTML element
    var balls = [];

    // defining the balls' radius
    var ballRadius = 10;

    // defining the balls' current initial speeds
    var dxCurrent = 5;
    var dyCurrent = 5;

    // setting up the slider
    var slider = document.getElementById("speedSlider");
    var output = document.getElementById("speed");
    output.innerHTML = slider.value;
    slider.oninput = adjustBallSpeed;

    // setting up the buttons
    var playPauseButton = document.querySelector("#playPauseButton")
    var addBallsButton = document.querySelector("#addBallsButton")

    // pause/play button
    var isDrawingLoopPaused = false;

    // function to draw a ball
    function drawBall(color, x, y) {
      // begin the instructions for drawing the ball
      ctx.beginPath();
      // (x, y) coordinates for the circle's center,
      // arc radius, start and end angle (in radians),
      // direction to draw the circle in ("false" indicates clockwise)
      ctx.arc(x,y,ballRadius,0,Math.PI*2,false);
      // define the ball's color
      ctx.fillStyle = color;
      // define the circle's fill pattern
      ctx.fill();
      // end of instructions for drawing the circle
      ctx.closePath();
    }

    // function to add new ball
    addBallsButton.onclick = function() {
      var ball = {
        color: '#'+Math.floor(Math.random()*16777215).toString(16),
        dx: dxCurrent,
        dy: dyCurrent,
        x: Math.floor(Math.random() * 10) * Math.floor(Math.random() * 10) + 10,
        y: Math.floor(Math.random() * 10) * Math.floor(Math.random() * 10) + 10,
      };
      balls.push(ball);

      // adding balls to html / sidebar. setting up click on delete.
      var ballNode = document.createElement("button");
      ballNode.style.backgroundColor = ball.color;
      ballNode.setAttribute("class", "ball");
      ballNode.addEventListener("click", deleteBall);
      document.getElementById('ballList').appendChild(ballNode);
    }

    // function to delete a ball on click
    function deleteBall(event) {
      var ballList = document.getElementById("ballList");
      var target = event.target;
      var indexToDelete = Array.prototype.indexOf.call(ballList.childNodes, target);
      balls.splice(indexToDelete, 1);
      ballList.removeChild(ballList.childNodes[indexToDelete]);
    }

    // define the function that will update the canvas:
    function draw() {
      // clear the canvas before redrawing
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // draw the balls
      balls.forEach(function(ball) {
        drawBall(ball.color, ball.x, ball.y);

        if (!isDrawingLoopPaused) {
          ball.x += ball.dx;
          ball.y += ball.dy;
        }

        if (ball.y + ball.dy < ballRadius || ball.y + ball.dy > (canvas.height - ballRadius)) {
          ball.dy = -ball.dy;
        }
        if (ball.x + ball.dx < ballRadius || ball.x + ball.dx > (canvas.width - ballRadius))  {
          ball.dx = -ball.dx;
        }
      })

      // smooth ball moving animation
      requestAnimationFrame(draw);
    }

    draw();

    // function to pause and restart ball Movement
    playPauseButton.onclick = function() {
      if (isDrawingLoopPaused) {
        isDrawingLoopPaused = false;
        document.getElementById("playPauseButton").textContent = "‚è∏Ô∏è";

      } else {
        isDrawingLoopPaused = true;
        document.getElementById("playPauseButton").textContent = "‚ñ∂Ô∏è";
      }
    }

    function adjustBallSpeed() {
      speed = this.value;
      output.textContent = this.value;
      // changing the speed of existing balls
      balls.forEach(function(ball) {
        if (ball.dx > 0) {
          ball.dx = +speed;
        } else {
          ball.dx = -speed;
        }
        if (ball.dy > 0) {
          ball.dy = +speed;
        } else {
          ball.dy = -speed;
        }
      })
      // changing the speed of balls to be added later
      dxCurrent = +speed;
      dyCurrent = +speed;
    }

  </script>

</body>

</html>
